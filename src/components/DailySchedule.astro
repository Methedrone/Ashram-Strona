---
import { getLangFromUrl, useTranslations } from '../i18n/utils';
import { ui, defaultLang } from '../i18n/ui';
import SectionHeading from './SectionHeading.astro';

interface ScheduleItem {
  time: string;
  activity: string;
  period: 'morning' | 'afternoon' | 'evening';
}

interface Props {
  items?: ScheduleItem[];
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const defaultItems: ScheduleItem[] = [
  { time: '06:00', activity: 'Aarati', period: 'morning' },
  { time: '07:00', activity: 'Meditation', period: 'morning' },
  { time: '08:00', activity: 'Breakfast', period: 'morning' },
  { time: '10:00', activity: 'Karma Yoga', period: 'morning' },
  { time: '13:00', activity: 'Lunch', period: 'afternoon' },
  { time: '15:00', activity: 'Tea Time', period: 'afternoon' },
  { time: '18:00', activity: 'Aarati', period: 'evening' },
  { time: '19:00', activity: 'Dinner', period: 'evening' },
  { time: '20:00', activity: 'Satsang', period: 'evening' },
];

const { items = defaultItems } = Astro.props;

const groupedItems = items.reduce((acc, item) => {
  if (!acc[item.period]) {
    acc[item.period] = [];
  }
  acc[item.period].push(item);
  return acc;
}, {} as Record<string, ScheduleItem[]>);

const periods = ['morning', 'afternoon', 'evening'] as const;
type UiKey = keyof typeof ui[typeof defaultLang];
---

<section class="daily-schedule">
  <SectionHeading title={t('schedule.title')} />
  
  <div class="schedule-container">
    {periods.map((period) => (
      groupedItems[period] && (
        <div class="period-column">
          <h3>{t(`schedule.${period}` as UiKey)}</h3>
          <ul class="schedule-list">
            {groupedItems[period].map((item) => (
              <li>
                <span class="time">{item.time}</span>
                <span class="activity">{item.activity}</span>
              </li>
            ))}
          </ul>
        </div>
      )
    ))}
  </div>
</section>

<style>
  .daily-schedule {
    padding: 4rem 2rem;
    background-color: var(--color-bg);
  }

  .schedule-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
    max-width: 1200px;
    margin: 0 auto;
  }

  .period-column {
    /* Semi-transparent warm background */
    background: linear-gradient(
      135deg,
      rgba(255, 252, 247, 0.9) 0%,
      rgba(250, 248, 245, 0.85) 50%,
      rgba(255, 252, 247, 0.9) 100%
    );
    
    border-radius: 20px;
    padding: 2rem;
    
    /* Golden glow shadows */
    box-shadow: 
      0 3px 20px -3px rgba(230, 168, 104, 0.2),
      0 2px 10px -2px rgba(155, 85, 57, 0.1),
      inset 0 1px 2px rgba(255, 255, 255, 0.8);
    
    /* Warm border with thicker top accent */
    border: 1px solid rgba(212, 175, 119, 0.25);
    border-top: 3px solid var(--color-gold);
    
    transition: all 0.4s ease;
    position: relative;
  }

  .period-column:hover {
    transform: translateY(-3px);
    box-shadow: 
      0 5px 28px -3px rgba(230, 168, 104, 0.25),
      0 3px 14px -2px rgba(155, 85, 57, 0.12),
      inset 0 1px 2px rgba(255, 255, 255, 1);
  }

  /* Add paper texture */
  .period-column::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 20px;
    background-image: 
      repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(212, 175, 119, 0.02) 2px,
        rgba(212, 175, 119, 0.02) 4px
      );
    pointer-events: none;
    opacity: 0.6;
    z-index: 0;
  }
  
  /* Ensure content stays above textured background */
  .period-column > * {
    position: relative;
    z-index: 1;
  }

  h3 {
    color: var(--color-orange);
    font-family: var(--font-family-serif);
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    text-align: center;
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 1rem;
  }

  .schedule-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .schedule-list li {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem 0;
    border-bottom: 1px dashed var(--color-border);
  }

  .schedule-list li:last-child {
    border-bottom: none;
  }

  .time {
    font-weight: bold;
    color: var(--color-text);
    font-family: monospace;
    font-size: 1.1rem;
  }

  .activity {
    color: var(--color-text-light);
  }
</style>
