---
import { getLangFromUrl, useTranslations } from '../i18n/utils';
import Schema from '../components/Schema.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

interface Props {
  title: string;
  schema?: Record<string, any>;
}

const { title, schema } = Astro.props;
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const siteUrl = 'https://babaji.org.pl';
const pageUrl = new URL(Astro.url.pathname, siteUrl).href;
const description = t('common.description');
const currentPath = Astro.url.pathname;

const defaultSchema: Record<string, any> = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "ReligiousOrganization",
      "name": "Ashram Babaji",
      "url": siteUrl,
      "logo": `${siteUrl}/favicon.svg`,
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Mąkolno 129",
        "addressLocality": "Mąkolno",
        "postalCode": "57-250",
        "addressCountry": "PL"
      }
    },
    {
      "@type": "WebSite",
      "name": "Ashram Babaji",
      "url": siteUrl,
      "potentialAction": {
        "@type": "SearchAction",
        "target": `${siteUrl}/search?q={search_term_string}`,
        "query-input": "required name=search_term_string"
      }
    }
  ]
};

const schemaOrg: Record<string, any> = { ...defaultSchema };
if (schema) {
  if (schema['@graph']) {
    schemaOrg['@graph'].push(...schema['@graph']);
  } else {
    schemaOrg['@graph'].push(schema);
  }
}
---

<!doctype html>
<html lang={lang}>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="manifest" href="/manifest.json" />
		<meta name="generator" content={Astro.generator} />
		<title>{title} | Ashram</title>
        
        <!-- SEO -->
        <meta name="description" content={description} />
        <link rel="canonical" href={pageUrl} />
        <link rel="sitemap" href="/sitemap-index.xml" />

        <!-- OpenGraph -->
        <meta property="og:type" content="website" />
        <meta property="og:url" content={pageUrl} />
        <meta property="og:title" content={`${title} | Ashram`} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={`${siteUrl}/favicon.svg`} />

        <!-- Twitter -->
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:title" content={`${title} | Ashram`} />
        <meta name="twitter:description" content={description} />
        <meta name="twitter:image" content={`${siteUrl}/favicon.svg`} />

        <!-- Schema.org -->
        <Schema schema={schemaOrg} />
	</head>
	<body>
		<Header activePath={currentPath} />
		<main>
			<h1>{title}</h1>
			<slot />
		</main>
		<Footer />
	</body>
</html>

<style>
    :root {
        --color-orange: #FF6B00;
        --color-gold: #FFD700;
        --color-text: #333;
        --color-bg: #fff;
        --color-header-bg: #fff;
        --color-footer-bg: #333;
        --color-footer-text: #fff;
    }

	html,
	body {
		margin: 0;
		padding: 0;
		width: 100%;
		height: 100%;
		font-family: system-ui, sans-serif;
		display: flex;
		flex-direction: column;
        background-color: var(--color-bg);
        color: var(--color-text);
	}
    body > * {
        flex-shrink: 0;
    }
    main {
        padding: 2rem;
        flex-grow: 1;
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
        box-sizing: border-box;
    }
    h1 {
        color: var(--color-orange);
    }
</style>
