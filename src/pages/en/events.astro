---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import EventCard from '../../components/EventCard.astro';
import SectionHeading from '../../components/SectionHeading.astro';
import { useTranslations } from '../../i18n/utils';

const lang = 'en';
const t = useTranslations(lang);
const siteUrl = 'https://babaji.org.pl';

const allEvents = await getCollection('events', ({ data }) => {
  return data.lang === lang;
});

const sortedEvents = allEvents.sort((a, b) => a.data.date.valueOf() - b.data.date.valueOf());

const upcomingEvents = sortedEvents.filter(event => event.data.date >= new Date());
const pastEvents = sortedEvents.filter(event => event.data.date < new Date()).reverse();
const itemList = sortedEvents.map((event, index) => ({
  "@type": "ListItem",
  "position": index + 1,
  "name": event.data.title,
  "url": `${siteUrl}/en/events/${event.slug.split('/').slice(1).join('/')}`
}));
---

<Layout title={t('nav.events')} description={t('meta.events.description')} ogImage="/og/events.jpg" schema={{
  "@type": "CollectionPage",
  "name": t('nav.events'),
  "description": t('meta.events.description'),
  "url": "https://babaji.org.pl/en/events",
  "inLanguage": "en",
  "numberOfItems": upcomingEvents.length,
  "mainEntity": {
    "@type": "ItemList",
    "itemListElement": itemList
  }
}}>
  <section class="events-page">
    <div class="container">
      <SectionHeading title={t('nav.events')} subtitle="Join us for celebrations and workshops" level={1} />

      <p class="intro">
        Events at Babaji Ashram are a place for shared practice and celebration.
        To deepen your path, explore our <a href="/en/practices">spiritual practices</a>
        and <a href="/en/teachings">teachings</a>.
      </p>
      
      {upcomingEvents.length > 0 ? (
        <div class="events-grid">
          {upcomingEvents.map(post => (
            <EventCard post={post} />
          ))}
        </div>
      ) : (
        <p class="no-content">No upcoming events currently scheduled.</p>
      )}

      {pastEvents.length > 0 && (
        <div class="past-events">
          <SectionHeading title="Past Events" align="left" />
          <div class="events-grid">
            {pastEvents.map(post => (
              <EventCard post={post} />
            ))}
          </div>
        </div>
      )}
    </div>
  </section>
</Layout>

<style>
  .events-page {
    padding: 4rem 0;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  .events-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 4rem;
  }

  .intro {
    font-size: 1.1rem;
    line-height: 1.7;
    color: var(--color-text-light);
    margin: 1.5rem 0 3rem;
  }

  .intro a {
    color: var(--color-orange);
    text-decoration: none;
  }

  .intro a:hover {
    text-decoration: underline;
  }

  .past-events {
    margin-top: 4rem;
    padding-top: 2rem;
    border-top: 1px solid var(--color-border);
  }

  .no-content {
    text-align: center;
    font-size: 1.2rem;
    color: var(--color-text-light);
    margin-top: 2rem;
  }
</style>
